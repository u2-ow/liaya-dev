---
import Layout from "../layouts/Layout.astro";
import dayjs from "dayjs";
import Header from "../components/Header.astro";
import Footer from "../components/footer.astro";

import { getBlogDetail, getBlogs } from "../lib/microcms";
// 詳細記事ページの全パスを取得
export async function getStaticPaths() {
  const response = await getBlogs({ fields: ["id"] });
  return response.contents.map((content: any) => ({
    params: {
      blogId: content.id,
    },
  }));
}

//記事の詳細情報を取得
const { blogId } = Astro.params;
const blog = await getBlogDetail(blogId as string); // 最初の要素のhtmlプロパティを取得
---

<Layout title="My first blog with Astro">
  <Header />

  <main class="post-container">
    <h1 class="post-container__title">{blog.title}</h1>
    <p class="post-container__publishedAt">
      公開日時：{dayjs(blog.publishedAt).format("YYYY/MM/DD")}
    </p>
    <div class="post" set:html={blog.content[0]?.html} />
  </main>
  <Footer />
</Layout>
